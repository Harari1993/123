{"version":3,"file":"ac-layer.component.js","sourceRoot":"","sources":["ac-layer.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { BillboardDrawerService } from '../../services/billboard-drawer/billboard-drawer.service';\r\nimport { Component, OnInit, Input, OnChanges, SimpleChanges, AfterContentInit } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { LayerService } from '../../services/layer-service/layer-service.service';\r\nimport { AcNotification } from '../../models/ac-notification';\r\nimport { ActionType } from '../../models/action-type.enum';\r\nimport { ComputationCache } from '../../services/computation-cache/computation-cache.service';\r\nimport { LabelDrawerService } from '../../services/label-drawer/label-drawer.service';\r\nimport { SimpleDrawerService } from '../../services/simple-drawer/simple-drawer.service';\r\nimport { StaticCircleDrawerService } from '../../services/static-circle-drawer/static-circle-drawer.service';\r\nimport { EllipseDrawerService } from '../../services/ellipse-drawer/ellipse-drawer.service';\r\nimport { DynamicEllipseDrawerService } from '../../services/ellipse-drawer/dynamic-ellipse-drawer.service';\r\nimport { DynamicPolylineDrawerService } from '../../services/dynamic-polyline-drawer/dynamic-polyline-drawer.service';\r\nimport { StaticPolylineDrawerService } from '../../services/static-polyline-drawer/static-polyline-drawer.service';\r\nimport { PolygonDrawerService } from '../../services/polygon-drawer/polygon-drawer.service';\r\nimport { ArcDrawerService } from '../../services/arc-drawer/arc-drawer.service';\r\n\r\n/**\r\n *  This is a ac-layer implementation.\r\n *  The ac-layer element must be a child of ac-map element.\r\n *  __param:__ {string} acfor - get the track observable and entityName (see the example)\r\n *  __param:__ {boolean} show - show/hide layer's entities\r\n *  __param:__ {any} context - get the context layer that will use the componnet (most of the time equal to \"this\")\r\n *\r\n *  __Usage :__\r\n *  ```\r\n *  &lt;ac-map&gt;\r\n *      &lt;ac-layer acFor=\"let track of tracks$\" [show]=\"showTracks\" [context]=\"this\"&gt;\r\n *          &lt;ac-billboard-desc props=\"{\r\n *               image: track.image,\r\n *               position: track.position,\r\n *               scale: track.scale,\r\n *               color: track.color,\r\n *               name: track.name\r\n *          }\"&gt;\r\n *      &lt;/ac-billboard-desc>\r\n *          &lt;ac-label-desc props=\"{\r\n *               position: track.position,\r\n *               pixelOffset : [-15,20] | pixelOffset,\r\n *               text: track.name,\r\n *               font: '15px sans-serif'\r\n *          }\"&gt;\r\n *          &lt;/ac-label-desc&gt;\r\n *      &lt;/ac-layer&gt;\r\n *  &lt;/ac-map&gt;\r\n *  ```\r\n */\r\n\r\nexport class AcLayerComponent implements OnInit, OnChanges, AfterContentInit {\r\n\tprivate static readonly acForRgx = /^let\\s+.+\\s+of\\s+.+$/;\r\n\r\n\t\r\n\tshow = true;\r\n\t\r\n\tacFor: string;\r\n\t\r\n\tcontext: any;\r\n\r\n\tprivate entityName: string;\r\n\tprivate observable: Observable<AcNotification>;\r\n\tprivate _drawerList: SimpleDrawerService[] = [];\r\n\tprivate _updateStream: Subject<AcNotification> = new Subject<AcNotification>();\r\n\r\n\tconstructor(private  layerService: LayerService,\r\n\t            private _computationCache: ComputationCache,\r\n\t            billboardDrawerService: BillboardDrawerService,\r\n\t            labelDrawerService: LabelDrawerService,\r\n\t            ellipseDrawerService: EllipseDrawerService,\r\n\t            dynamicEllipseDrawerService: DynamicEllipseDrawerService,\r\n\t            dynamicPolylineDrawerService: DynamicPolylineDrawerService,\r\n\t            staticCircleDrawerService: StaticCircleDrawerService,\r\n\t            staticPolylineDrawerService: StaticPolylineDrawerService,\r\n\t            polygonDrawerService: PolygonDrawerService,\r\n\t            arcDrawerService: ArcDrawerService) {\r\n\t\tthis._drawerList = Array.of(\r\n\t\t\tbillboardDrawerService,\r\n\t\t\tlabelDrawerService,\r\n\t\t\tellipseDrawerService,\r\n\t\t\tdynamicEllipseDrawerService,\r\n\t\t\tdynamicPolylineDrawerService,\r\n\t\t\tstaticCircleDrawerService,\r\n\t\t\tstaticPolylineDrawerService,\r\n\t\t\tpolygonDrawerService,\r\n\t\t\tarcDrawerService\r\n\t\t);\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.initValidParams();\r\n\r\n\t\tthis.observable.merge(this._updateStream).subscribe((notification) => {\r\n\t\t\tthis._computationCache.clear();\r\n\t\t\tthis.context[this.entityName] = notification.entity;\r\n\t\t\tthis.layerService.getDescriptions().forEach((descriptionComponent) => {\r\n\t\t\t\tswitch (notification.actionType) {\r\n\t\t\t\t\tcase ActionType.ADD_UPDATE:\r\n\t\t\t\t\t\tdescriptionComponent.draw(this.context, notification.id, notification.entity);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase ActionType.DELETE:\r\n\t\t\t\t\t\tdescriptionComponent.remove(notification.id);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.error('unknown action type: ' + notification.actionType);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate initValidParams() {\r\n\t\tif (!this.context) {\r\n\t\t\tthrow 'ac-layer: must initialize [context] ';\r\n\t\t}\r\n\r\n\t\tif (!AcLayerComponent.acForRgx.test(this.acFor)) {\r\n\t\t\tthrow 'ac-layer: must initialize [acFor] with a valid syntax \\' [acFor]=\\\"let item of observer$\\\" \\' '\r\n\t\t\t+ 'instead received: ' + this.acFor;\r\n\t\t}\r\n\t\tconst acForArr = this.acFor.split(' ');\r\n\t\tthis.observable = this.context[acForArr[3]];\r\n\t\tthis.entityName = acForArr[1];\r\n\t\tif (!this.observable || !(this.observable instanceof Observable)) {\r\n\t\t\tthrow  'ac-layer: must initailize [acFor] with rx observable, instead received: ' + this.observable;\r\n\t\t}\r\n\t}\r\n\r\n\tngAfterContentInit(): void {\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tngOnInit(): void {\r\n\t}\r\n\r\n\tngOnChanges(changes: SimpleChanges): void {\r\n\t\tif (changes['show']) {\r\n\t\t\tconst showValue = changes['show'].currentValue;\r\n\t\t\tthis._drawerList.forEach((drawer) => drawer.setShow(showValue));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Remove all the entities from the layer.\r\n\t */\r\n\tremoveAll(): void {\r\n\t\tthis.layerService.getDescriptions().forEach((description) => description.removeAll());\r\n\t}\r\n\r\n\t/**\r\n\t * remove 1 entity from the layer\r\n\t * @param {number} entityId\r\n\t */\r\n\tremove(entityId: number) {\r\n\t\tthis._updateStream.next({id: entityId, actionType: ActionType.DELETE});\r\n\t}\r\n\r\n\t/**\r\n\t * update 1 entity from the layer\r\n\t * @param {AcNotification} notification\r\n\t */\r\n\tupdate(notification: AcNotification): void {\r\n\t\tthis._updateStream.next(notification);\r\n\t}\r\n\r\n\trefreshAll(collection: AcNotification[]): void {\r\n\t\t// TODO make entity interface: collection of type entity not notification\r\n\t\tObservable.from(collection).subscribe((entity) => this._updateStream.next(entity));\r\n\t}\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\r\n\tselector: 'ac-layer',\r\n\ttemplate: '',\r\n\tproviders: [\r\n\t\tLayerService, ComputationCache, BillboardDrawerService, LabelDrawerService, EllipseDrawerService,\r\n\t\tDynamicEllipseDrawerService, DynamicPolylineDrawerService, StaticCircleDrawerService,\r\n\t\tStaticPolylineDrawerService, PolygonDrawerService, ArcDrawerService\r\n\t]\r\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: LayerService, },\n{type: ComputationCache, },\n{type: BillboardDrawerService, },\n{type: LabelDrawerService, },\n{type: EllipseDrawerService, },\n{type: DynamicEllipseDrawerService, },\n{type: DynamicPolylineDrawerService, },\n{type: StaticCircleDrawerService, },\n{type: StaticPolylineDrawerService, },\n{type: PolygonDrawerService, },\n{type: ArcDrawerService, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'show': [{ type: Input },],\n'acFor': [{ type: Input },],\n'context': [{ type: Input },],\n};\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}